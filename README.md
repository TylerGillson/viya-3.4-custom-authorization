# Viya 3.4 Custom Authorization
A collection of scripts for maintaining custom authorization groups in SAS Viya 3.4. Read the full documentation <a href=https://viya-34-custom-authorization.readthedocs.io/en/latest/>here</a>.

# Overview
The generate_custom_authorization_groups.py script authorizes itself with a SAS Viya services node, then proceeds to programmatically generate custom Viya groups based on the contents of a custom group definition file. The script's configuration is outlined in config.py, but all configuration values can optionally be specified at the command line.

The group definition file must be in CSV format and be structured as follows:

```bash
auto_group_name,auto_group_id,group_1_id,group_2_id,...,group_n_id
<custom_group_name>,<custom_group_id><ldap_group_id>,<ldap_group_id>,...,<ldap_group_id>
...
```

For each row in the custom group definition file, the script will query the SAS Viya Identities REST API to accomplish the following:
  1. Determine the custom group's membership. This is the overall intersection of input group_1 through group_n, i.e. determine which users are in ALL of the input groups.
  2. Create the automatically maintained group if it does not already exist
  3. Add net-new users to the automatically maintained group
  4. Remove deprecated users from the automatically maintained group

# Usage
  ```bash
  python generate_custom_authorization_groups.py [--options]
  ```
  Options include:
  * --sas-endpoint (-se): Base URL of the Viya Services node in your target deployment
  * --credentials-path (-cp): Local filesystem path to the credentials.json file generated by the sas-admin CLI
  * --log-root (-lr): Local filesystem path specifying the root location to write log files into
  * --auto-group-file (-agf): Location of the file containing all auto-maintained group definitions
  
  Note: In order to successfully authenticate with the remote SAS Viya services host, you must have the following environment variables set:
  * VIYA_USERNAME
  * VIYA_PASSWORD
  
  The environment variables are used by the SAS Administration CLI to generate a bearer token for authorizing HTTP requests against the SAS Identities API.
  
# Examples
  1. Create and/or maintain auto-maintained groups from a group definition file specified at run-time:
  ```bash
     python generate_custom_authorization_groups.py -agf auto-groups.csv
  ```
  2. Same as above, but exercising all command-line options:
  ``` bash
     python generate_custom_authorization_groups.py \
      --sas-endpoint http://cantyg-full-viya.canpsd-fcc.sashq-d.openstack.sas.com \
      --credentials-path C:\\Users\\cantyg\\.sas\\credentials.json \
      --log-root C:\\Users\\cantyg\\Downloads\\SA_AUTHORIZATION \
      --auto-group-file C:\\Users\\cantyg\\Downloads\\SA_AUTHORIZATION\\auto-maintained-groups.csv
  ```
